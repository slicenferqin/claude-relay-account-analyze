import{_ as se}from"./_plugin-vue_export-helper-BJA4NJ9J.js";/* empty css                 *//* empty css                   *//* empty css                        *//* empty css                    *//* empty css               */import{f as V,a as w,b as oe}from"./format-B4y3xwuR.js";/* empty css                *//* empty css                  *//* empty css                  */import{l as ne,r as T,c as ie,e as de,J as ue,m as b,q as _,t as i,H as e,B as t,u as o,G as $,Y,F as d,C as re,A as g,D as U,L as j}from"./vue-vendor-C0qDyb5Q.js";import{at as ce,a8 as pe,a7 as _e,au as me,ai as fe,ak as ve,S as ye,ag as ge,ah as he,av as be,aw as Ae,aj as ke,a1 as n,W as Ce,Y as we,am as Ie,ao as Ee,ax as xe,ay as Ve,az as De,a5 as Ke,a4 as Te,as as Ue,ar as Pe,p as Se,aA as Le,aB as Re,aC as ze}from"./element-plus-A89xnwnm.js";import{u as Be,a as Ge}from"./index-BnHm-nza.js";import{d as Me}from"./utils-AU2jKXl8.js";const qe={class:"api-keys-view"},Ne={class:"header-actions"},Fe={class:"filters"},$e={class:"actions"},Ye={class:"stats-cards"},je={class:"stat-card"},He={class:"stat-value"},Je={class:"stat-card"},Oe={class:"stat-value"},We={class:"stat-card"},Qe={class:"stat-value"},Xe={class:"stat-card"},Ze={class:"stat-value"},et={class:"card-header"},tt={class:"api-key-name"},at={key:0,class:"tags"},lt={key:1,class:"never-used"},st={class:"rpm-display"},ot={class:"rpm-text"},nt={key:0,class:"api-key-details"},it={key:1},dt=ne({__name:"ApiKeysView",setup(ut){const m=Be(),P=Ge(),p=T({groupId:"",isActive:!0,search:""}),D=T(!1),r=T(null),S=ie(()=>{let s=m.apiKeys;if(p.value.groupId&&(s=s.filter(l=>{var c;return((c=l.currentGroup)==null?void 0:c.id)===p.value.groupId})),p.value.isActive!==void 0&&(s=s.filter(l=>l.isActive===p.value.isActive)),p.value.search){const l=p.value.search.toLowerCase();s=s.filter(c=>{var h;return c.name.toLowerCase().includes(l)||((h=c.description)==null?void 0:h.toLowerCase().includes(l))||c.keyId.toLowerCase().includes(l)})}return s=[...s].sort((l,c)=>{if(!l.lastUsedAt&&!c.lastUsedAt)return 0;if(!l.lastUsedAt)return 1;if(!c.lastUsedAt)return-1;const h=new Date(l.lastUsedAt).getTime();return new Date(c.lastUsedAt).getTime()-h}),s}),K=()=>{m.updateApiKeyFilters({groupId:p.value.groupId||void 0,isActive:p.value.isActive,search:p.value.search||void 0})},H=Me(()=>{K()},500),L=async()=>{await m.fetchApiKeys()},J=()=>{console.log("Export API Keys data")},R=s=>{r.value=s,D.value=!0,P.subscribeToApiKey(s.keyId)},O=s=>{console.log("Show usage chart for",s.name)},W=s=>Math.min(s/100*100,100),Q=s=>s<10?"#67c23a":s<50?"#e6a23c":"#f56c6c",X=s=>s>50?"high-cost":s>20?"medium-cost":"low-cost";return de(async()=>{await m.fetchGroups(),await L()}),ue(()=>{m.apiKeys.forEach(s=>{P.unsubscribe("apikey",s.keyId)})}),(s,l)=>{var q;const c=he,h=ge,z=be,B=ce,I=_e,E=Ce,k=ve,A=ke,G=fe,x=Ke,C=Pe,y=De,Z=Te,ee=Ue,te=ze,v=Re,M=Le,ae=ye,le=Ve;return _(),b("div",qe,[i("div",Ne,[i("div",Fe,[e(B,null,{default:t(()=>[e(h,{modelValue:p.value.groupId,"onUpdate:modelValue":l[0]||(l[0]=a=>p.value.groupId=a),placeholder:"选择分组",clearable:"",onChange:K},{default:t(()=>[e(c,{label:"全部分组",value:""}),(_(!0),b($,null,Y(o(m).groups,a=>(_(),g(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(h,{modelValue:p.value.isActive,"onUpdate:modelValue":l[1]||(l[1]=a=>p.value.isActive=a),placeholder:"状态",onChange:K},{default:t(()=>[e(c,{label:"全部状态",value:void 0}),e(c,{label:"活跃",value:!0}),e(c,{label:"非活跃",value:!1})]),_:1},8,["modelValue"]),e(z,{modelValue:p.value.search,"onUpdate:modelValue":l[2]||(l[2]=a=>p.value.search=a),placeholder:"搜索API Key","prefix-icon":o(Ae),clearable:"",onInput:o(H),style:{width:"200px"}},null,8,["modelValue","prefix-icon","onInput"])]),_:1})]),i("div",$e,[e(I,{type:"primary",icon:o(pe),loading:o(m).loading,onClick:L},{default:t(()=>[...l[4]||(l[4]=[d(" 刷新 ",-1)])]),_:1},8,["icon","loading"]),e(I,{icon:o(me),onClick:J},{default:t(()=>[...l[5]||(l[5]=[d(" 导出 ",-1)])]),_:1},8,["icon"])])]),i("div",Ye,[e(G,{gutter:16},{default:t(()=>[e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",je,[i("div",He,n(o(m).activeApiKeys.length),1),l[6]||(l[6]=i("div",{class:"stat-label"},"活跃API Keys",-1)),e(E,{class:"stat-icon"},{default:t(()=>[e(o(we))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",Je,[i("div",Oe,n(o(V)(o(m).totalDailyCost)),1),l[7]||(l[7]=i("div",{class:"stat-label"},"今日总消费",-1)),e(E,{class:"stat-icon"},{default:t(()=>[e(o(Ie))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",We,[i("div",Qe,n(o(w)(o(m).totalTodayRequests)),1),l[8]||(l[8]=i("div",{class:"stat-label"},"今日总请求",-1)),e(E,{class:"stat-icon"},{default:t(()=>[e(o(Ee))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",Xe,[i("div",Ze,n(o(m).averageRPM),1),l[9]||(l[9]=i("div",{class:"stat-label"},"平均RPM",-1)),e(E,{class:"stat-icon"},{default:t(()=>[e(o(xe))]),_:1})])]),_:1})]),_:1})]),_:1})]),e(k,null,{header:t(()=>[i("div",et,[l[10]||(l[10]=i("span",null,"API Key 列表",-1)),e(x,{type:"info",size:"small"},{default:t(()=>[d(" 共 "+n(S.value.length)+" 个API Key ",1)]),_:1})])]),default:t(()=>[re((_(),g(te,{data:S.value,stripe:"",style:{width:"100%"},flexible:!0,onRowClick:R},{default:t(()=>[e(y,{prop:"name",label:"API Key名称","min-width":"200"},{default:t(({row:a})=>{var u;return[i("div",tt,[e(x,{strong:""},{default:t(()=>[d(n(a.name),1)]),_:2},1024),(u=a.tags)!=null&&u.length?(_(),b("div",at,[(_(!0),b($,null,Y(a.tags.slice(0,2),f=>(_(),g(C,{key:f,size:"small",type:"info"},{default:t(()=>[d(n(f),1)]),_:2},1024))),128)),a.tags.length>2?(_(),g(x,{key:0,size:"small",type:"info"},{default:t(()=>[d(" +"+n(a.tags.length-2),1)]),_:2},1024)):U("",!0)])):U("",!0)])]}),_:1}),e(y,{prop:"lastUsedAt",label:"最后使用时间","min-width":"150",sortable:""},{default:t(({row:a})=>[a.lastUsedAt?(_(),g(Z,{key:0,content:new Date(a.lastUsedAt).toLocaleString()},{default:t(()=>[i("span",null,n(o(oe)(a.lastUsedAt)),1)]),_:2},1032,["content"])):(_(),b("span",lt,"从未使用"))]),_:1}),e(y,{prop:"rpm",label:"RPM",width:"100",sortable:""},{default:t(({row:a})=>[i("div",st,[e(ee,{percentage:W(a.rpm),color:Q(a.rpm),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),i("span",ot,n(a.rpm),1)])]),_:1}),e(y,{prop:"currentGroup",label:"所属分组","min-width":"120"},{default:t(({row:a})=>[a.currentGroup?(_(),g(C,{key:0,type:"primary",size:"small"},{default:t(()=>[d(n(a.currentGroup.name),1)]),_:2},1024)):(_(),g(x,{key:1,type:"info",size:"small"},{default:t(()=>[...l[11]||(l[11]=[d("未分组",-1)])]),_:1}))]),_:1}),e(y,{prop:"usage.today.cost",label:"今日消费",width:"110",sortable:""},{default:t(({row:a})=>{var u,f,N,F;return[i("span",{class:Se(X(((f=(u=a.usage)==null?void 0:u.today)==null?void 0:f.cost)||0))},n(o(V)(((F=(N=a.usage)==null?void 0:N.today)==null?void 0:F.cost)||0)),3)]}),_:1}),e(y,{prop:"usage.today.requests",label:"今日请求",width:"110",sortable:""},{default:t(({row:a})=>{var u,f;return[d(n(o(w)(((f=(u=a.usage)==null?void 0:u.today)==null?void 0:f.requests)||0)),1)]}),_:1}),e(y,{prop:"usage.today.totalTokens",label:"今日Token","min-width":"130",sortable:""},{default:t(({row:a})=>{var u,f;return[d(n(o(w)(((f=(u=a.usage)==null?void 0:u.today)==null?void 0:f.totalTokens)||0)),1)]}),_:1}),e(y,{prop:"isActive",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[e(C,{type:a.isActive?"success":"danger",size:"small"},{default:t(()=>[d(n(a.isActive?"活跃":"非活跃"),1)]),_:2},1032,["type"])]),_:1}),e(y,{label:"操作","min-width":"140",fixed:"right"},{default:t(({row:a})=>[e(B,null,{default:t(()=>[e(I,{size:"small",onClick:j(u=>R(a),["stop"])},{default:t(()=>[...l[12]||(l[12]=[d(" 详情 ",-1)])]),_:1},8,["onClick"]),e(I,{size:"small",onClick:j(u=>O(a),["stop"])},{default:t(()=>[...l[13]||(l[13]=[d(" 趋势 ",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[le,o(m).loading]])]),_:1}),e(ae,{modelValue:D.value,"onUpdate:modelValue":l[3]||(l[3]=a=>D.value=a),title:`API Key: ${(q=r.value)==null?void 0:q.name}`,width:"800px"},{default:t(()=>[r.value?(_(),b("div",nt,[e(G,{gutter:16},{default:t(()=>[e(A,{span:12},{default:t(()=>[e(M,{title:"基本信息",column:1,border:""},{default:t(()=>[e(v,{label:"名称"},{default:t(()=>[d(n(r.value.name),1)]),_:1}),e(v,{label:"描述"},{default:t(()=>[d(n(r.value.description||"无"),1)]),_:1}),e(v,{label:"状态"},{default:t(()=>[e(C,{type:r.value.isActive?"success":"danger"},{default:t(()=>[d(n(r.value.isActive?"活跃":"非活跃"),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"所属分组"},{default:t(()=>[r.value.currentGroup?(_(),g(C,{key:0,type:"primary"},{default:t(()=>[d(n(r.value.currentGroup.name),1)]),_:1})):(_(),b("span",it,"未分组"))]),_:1}),e(v,{label:"最后使用"},{default:t(()=>[d(n(new Date(r.value.lastUsedAt).toLocaleString()),1)]),_:1})]),_:1})]),_:1}),e(A,{span:12},{default:t(()=>[e(M,{title:"使用统计",column:1,border:""},{default:t(()=>[e(v,{label:"RPM"},{default:t(()=>[d(n(r.value.rpm),1)]),_:1}),e(v,{label:"今日请求"},{default:t(()=>{var a,u;return[d(n(o(w)(((u=(a=r.value.usage)==null?void 0:a.today)==null?void 0:u.requests)||0)),1)]}),_:1}),e(v,{label:"今日Token"},{default:t(()=>{var a,u;return[d(n(o(w)(((u=(a=r.value.usage)==null?void 0:a.today)==null?void 0:u.totalTokens)||0)),1)]}),_:1}),e(v,{label:"今日费用"},{default:t(()=>{var a,u;return[d(n(o(V)(((u=(a=r.value.usage)==null?void 0:a.today)==null?void 0:u.cost)||0)),1)]}),_:1}),e(v,{label:"费用限制"},{default:t(()=>{var a;return[d(n((a=r.value.limits)!=null&&a.dailyCostLimit?o(V)(r.value.limits.dailyCostLimit):"无限制"),1)]}),_:1})]),_:1})]),_:1})]),_:1})])):U("",!0)]),_:1},8,["modelValue","title"])])}}}),wt=se(dt,[["__scopeId","data-v-3d97e98c"]]);export{wt as default};
//# sourceMappingURL=ApiKeysView-TYsyCGpa.js.map
