import{_ as ne}from"./_plugin-vue_export-helper-BJA4NJ9J.js";/* empty css                 *//* empty css                   *//* empty css                        *//* empty css                    *//* empty css               */import{f as K,a as w,b as ie}from"./format-B4y3xwuR.js";/* empty css                *//* empty css                  *//* empty css                  */import{l as de,r as S,c as ce,e as ue,M as re,m as b,t as i,K as e,D as t,u as s,J,$ as O,H as n,I as o,E as _e,C as y,F as P,y as pe,O as Q,aq as me,ar as fe,q as p}from"./vue-vendor-CPEpqY2A.js";import{S as ve,s as he,r as ye,T as ge,H as be,J as Ae,c as ke,C as Ce,D as we,U as Ie,V as Ee,I as xe,g as Ve,k as De,L as Ke,N as Te,W as Ue,X as Se,Y as Pe,p as Re,n as Le,R as ze,Q as Me,Z as Be,_ as Ge,$ as qe}from"./element-plus-7iBGeLeB.js";import{u as Ne,a as $e}from"./index-BkPn-YD4.js";import{d as Fe}from"./utils-C5IX4h6x.js";const I=E=>(me("data-v-3d97e98c"),E=E(),fe(),E),He={class:"api-keys-view"},Je={class:"header-actions"},Oe={class:"filters"},Qe={class:"actions"},We={class:"stats-cards"},Xe={class:"stat-card"},Ye={class:"stat-value"},Ze=I(()=>i("div",{class:"stat-label"},"活跃API Keys",-1)),je={class:"stat-card"},et={class:"stat-value"},tt=I(()=>i("div",{class:"stat-label"},"今日总消费",-1)),at={class:"stat-card"},st={class:"stat-value"},lt=I(()=>i("div",{class:"stat-label"},"今日总请求",-1)),ot={class:"stat-card"},nt={class:"stat-value"},it=I(()=>i("div",{class:"stat-label"},"平均RPM",-1)),dt={class:"card-header"},ct=I(()=>i("span",null,"API Key 列表",-1)),ut={class:"api-key-name"},rt={key:0,class:"tags"},_t={key:1,class:"never-used"},pt={class:"rpm-display"},mt={class:"rpm-text"},ft={key:0,class:"api-key-details"},vt={key:1},ht=de({__name:"ApiKeysView",setup(E){const m=Ne(),R=$e(),_=S({groupId:"",isActive:!0,search:""}),T=S(!1),u=S(null),L=ce(()=>{let l=m.apiKeys;if(_.value.groupId&&(l=l.filter(c=>{var r;return((r=c.currentGroup)==null?void 0:r.id)===_.value.groupId})),_.value.isActive!==void 0&&(l=l.filter(c=>c.isActive===_.value.isActive)),_.value.search){const c=_.value.search.toLowerCase();l=l.filter(r=>{var g;return r.name.toLowerCase().includes(c)||((g=r.description)==null?void 0:g.toLowerCase().includes(c))||r.keyId.toLowerCase().includes(c)})}return l=[...l].sort((c,r)=>{if(!c.lastUsedAt&&!r.lastUsedAt)return 0;if(!c.lastUsedAt)return 1;if(!r.lastUsedAt)return-1;const g=new Date(c.lastUsedAt).getTime();return new Date(r.lastUsedAt).getTime()-g}),l}),U=()=>{m.updateApiKeyFilters({groupId:_.value.groupId||void 0,isActive:_.value.isActive,search:_.value.search||void 0})},W=Fe(()=>{U()},500),z=async()=>{await m.fetchApiKeys()},X=()=>{console.log("Export API Keys data")},M=l=>{u.value=l,T.value=!0,R.subscribeToApiKey(l.keyId)},Y=l=>{console.log("Show usage chart for",l.name)},Z=l=>Math.min(l/100*100,100),j=l=>l<10?"#67c23a":l<50?"#e6a23c":"#f56c6c",ee=l=>l>50?"high-cost":l>20?"medium-cost":"low-cost";return ue(async()=>{await m.fetchGroups(),await z()}),re(()=>{m.apiKeys.forEach(l=>{R.unsubscribe("apikey",l.keyId)})}),(l,c)=>{var $;const r=we,g=Ce,B=Ie,G=ve,x=ye,V=Ve,k=Ae,A=xe,q=be,D=Re,C=Me,h=Pe,te=Le,ae=ze,se=qe,v=Ge,N=Be,le=ke,oe=Se;return p(),b("div",He,[i("div",Je,[i("div",Oe,[e(G,null,{default:t(()=>[e(g,{modelValue:_.value.groupId,"onUpdate:modelValue":c[0]||(c[0]=a=>_.value.groupId=a),placeholder:"选择分组",clearable:"",onChange:U},{default:t(()=>[e(r,{label:"全部分组",value:""}),(p(!0),b(J,null,O(s(m).groups,a=>(p(),y(r,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(g,{modelValue:_.value.isActive,"onUpdate:modelValue":c[1]||(c[1]=a=>_.value.isActive=a),placeholder:"状态",onChange:U},{default:t(()=>[e(r,{label:"全部状态",value:void 0}),e(r,{label:"活跃",value:!0}),e(r,{label:"非活跃",value:!1})]),_:1},8,["modelValue"]),e(B,{modelValue:_.value.search,"onUpdate:modelValue":c[2]||(c[2]=a=>_.value.search=a),placeholder:"搜索API Key","prefix-icon":s(Ee),clearable:"",onInput:s(W),style:{width:"200px"}},null,8,["modelValue","prefix-icon","onInput"])]),_:1})]),i("div",Qe,[e(x,{type:"primary",icon:s(he),loading:s(m).loading,onClick:z},{default:t(()=>[n(" 刷新 ")]),_:1},8,["icon","loading"]),e(x,{icon:s(ge),onClick:X},{default:t(()=>[n(" 导出 ")]),_:1},8,["icon"])])]),i("div",We,[e(q,{gutter:16},{default:t(()=>[e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",Xe,[i("div",Ye,o(s(m).activeApiKeys.length),1),Ze,e(V,{class:"stat-icon"},{default:t(()=>[e(s(De))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",je,[i("div",et,o(s(K)(s(m).totalDailyCost)),1),tt,e(V,{class:"stat-icon"},{default:t(()=>[e(s(Ke))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",at,[i("div",st,o(s(w)(s(m).totalTodayRequests)),1),lt,e(V,{class:"stat-icon"},{default:t(()=>[e(s(Te))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[i("div",ot,[i("div",nt,o(s(m).averageRPM),1),it,e(V,{class:"stat-icon"},{default:t(()=>[e(s(Ue))]),_:1})])]),_:1})]),_:1})]),_:1})]),e(k,null,{header:t(()=>[i("div",dt,[ct,e(D,{type:"info",size:"small"},{default:t(()=>[n(" 共 "+o(s(L).length)+" 个API Key ",1)]),_:1})])]),default:t(()=>[_e((p(),y(se,{data:s(L),stripe:"",style:{width:"100%"},flexible:!0,onRowClick:M},{default:t(()=>[e(h,{prop:"name",label:"API Key名称","min-width":"200"},{default:t(({row:a})=>{var d;return[i("div",ut,[e(D,{strong:""},{default:t(()=>[n(o(a.name),1)]),_:2},1024),(d=a.tags)!=null&&d.length?(p(),b("div",rt,[(p(!0),b(J,null,O(a.tags.slice(0,2),f=>(p(),y(C,{key:f,size:"small",type:"info"},{default:t(()=>[n(o(f),1)]),_:2},1024))),128)),a.tags.length>2?(p(),y(D,{key:0,size:"small",type:"info"},{default:t(()=>[n(" +"+o(a.tags.length-2),1)]),_:2},1024)):P("",!0)])):P("",!0)])]}),_:1}),e(h,{prop:"lastUsedAt",label:"最后使用时间","min-width":"150",sortable:""},{default:t(({row:a})=>[a.lastUsedAt?(p(),y(te,{key:0,content:new Date(a.lastUsedAt).toLocaleString()},{default:t(()=>[i("span",null,o(s(ie)(a.lastUsedAt)),1)]),_:2},1032,["content"])):(p(),b("span",_t,"从未使用"))]),_:1}),e(h,{prop:"rpm",label:"RPM",width:"100",sortable:""},{default:t(({row:a})=>[i("div",pt,[e(ae,{percentage:Z(a.rpm),color:j(a.rpm),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),i("span",mt,o(a.rpm),1)])]),_:1}),e(h,{prop:"currentGroup",label:"所属分组","min-width":"120"},{default:t(({row:a})=>[a.currentGroup?(p(),y(C,{key:0,type:"primary",size:"small"},{default:t(()=>[n(o(a.currentGroup.name),1)]),_:2},1024)):(p(),y(D,{key:1,type:"info",size:"small"},{default:t(()=>[n("未分组")]),_:1}))]),_:1}),e(h,{prop:"usage.today.cost",label:"今日消费",width:"110",sortable:""},{default:t(({row:a})=>{var d,f,F,H;return[i("span",{class:pe(ee(((f=(d=a.usage)==null?void 0:d.today)==null?void 0:f.cost)||0))},o(s(K)(((H=(F=a.usage)==null?void 0:F.today)==null?void 0:H.cost)||0)),3)]}),_:1}),e(h,{prop:"usage.today.requests",label:"今日请求",width:"110",sortable:""},{default:t(({row:a})=>{var d,f;return[n(o(s(w)(((f=(d=a.usage)==null?void 0:d.today)==null?void 0:f.requests)||0)),1)]}),_:1}),e(h,{prop:"usage.today.totalTokens",label:"今日Token","min-width":"130",sortable:""},{default:t(({row:a})=>{var d,f;return[n(o(s(w)(((f=(d=a.usage)==null?void 0:d.today)==null?void 0:f.totalTokens)||0)),1)]}),_:1}),e(h,{prop:"isActive",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[e(C,{type:a.isActive?"success":"danger",size:"small"},{default:t(()=>[n(o(a.isActive?"活跃":"非活跃"),1)]),_:2},1032,["type"])]),_:1}),e(h,{label:"操作","min-width":"140",fixed:"right"},{default:t(({row:a})=>[e(G,null,{default:t(()=>[e(x,{size:"small",onClick:Q(d=>M(a),["stop"])},{default:t(()=>[n(" 详情 ")]),_:2},1032,["onClick"]),e(x,{size:"small",onClick:Q(d=>Y(a),["stop"])},{default:t(()=>[n(" 趋势 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[oe,s(m).loading]])]),_:1}),e(le,{modelValue:T.value,"onUpdate:modelValue":c[3]||(c[3]=a=>T.value=a),title:`API Key: ${($=u.value)==null?void 0:$.name}`,width:"800px"},{default:t(()=>[u.value?(p(),b("div",ft,[e(q,{gutter:16},{default:t(()=>[e(A,{span:12},{default:t(()=>[e(N,{title:"基本信息",column:1,border:""},{default:t(()=>[e(v,{label:"名称"},{default:t(()=>[n(o(u.value.name),1)]),_:1}),e(v,{label:"描述"},{default:t(()=>[n(o(u.value.description||"无"),1)]),_:1}),e(v,{label:"状态"},{default:t(()=>[e(C,{type:u.value.isActive?"success":"danger"},{default:t(()=>[n(o(u.value.isActive?"活跃":"非活跃"),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"所属分组"},{default:t(()=>[u.value.currentGroup?(p(),y(C,{key:0,type:"primary"},{default:t(()=>[n(o(u.value.currentGroup.name),1)]),_:1})):(p(),b("span",vt,"未分组"))]),_:1}),e(v,{label:"最后使用"},{default:t(()=>[n(o(new Date(u.value.lastUsedAt).toLocaleString()),1)]),_:1})]),_:1})]),_:1}),e(A,{span:12},{default:t(()=>[e(N,{title:"使用统计",column:1,border:""},{default:t(()=>[e(v,{label:"RPM"},{default:t(()=>[n(o(u.value.rpm),1)]),_:1}),e(v,{label:"今日请求"},{default:t(()=>{var a,d;return[n(o(s(w)(((d=(a=u.value.usage)==null?void 0:a.today)==null?void 0:d.requests)||0)),1)]}),_:1}),e(v,{label:"今日Token"},{default:t(()=>{var a,d;return[n(o(s(w)(((d=(a=u.value.usage)==null?void 0:a.today)==null?void 0:d.totalTokens)||0)),1)]}),_:1}),e(v,{label:"今日费用"},{default:t(()=>{var a,d;return[n(o(s(K)(((d=(a=u.value.usage)==null?void 0:a.today)==null?void 0:d.cost)||0)),1)]}),_:1}),e(v,{label:"费用限制"},{default:t(()=>{var a;return[n(o((a=u.value.limits)!=null&&a.dailyCostLimit?s(K)(u.value.limits.dailyCostLimit):"无限制"),1)]}),_:1})]),_:1})]),_:1})]),_:1})])):P("",!0)]),_:1},8,["modelValue","title"])])}}}),Ut=ne(ht,[["__scopeId","data-v-3d97e98c"]]);export{Ut as default};
