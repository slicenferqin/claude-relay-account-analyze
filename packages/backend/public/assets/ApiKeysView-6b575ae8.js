import{_ as fe}from"./_plugin-vue_export-helper-9440082a.js";import{v as me}from"./el-loading-51784694.js";import{P as C,x as Z,y as ve,z as he,v as ye,p as ge}from"./el-tooltip-93191788.js";import{E as be,a as Ae,b as Se,c as we}from"./el-table-column-a38cbaef.js";import{E as Ee}from"./el-tag-c224873b.js";import{E as ke}from"./el-progress-a6dd58eb.js";import{E as xe,f as O,a as K,c as Ce,b as Ie}from"./format-cc1ffcfc.js";import{E as Pe}from"./el-card-bc3ae3d9.js";/* empty css                */import{E as Te}from"./el-button-fdb418f9.js";import{E as Ve,a as ze,b as Ke}from"./el-select-dc8a6578.js";import{e as oe,g as W,u as ne,H as U,ai as Ue,l as ie,h as D,an as De,a2 as R,aq as F,q as j,aT as ce,a3 as Re,a1 as Le,Q as e,ad as p,B as Be,ax as Ne,ay as $e,o as Ge,aB as Me,k,w as c,y as t,m as l,j as f,a0 as ee,aS as te,aU as qe,aH as Oe,aV as je,A as i,aD as Fe,aQ as Ye,aR as We,aW as He,aj as Qe,x as T,$ as Y,n as Je,au as ae,E as Xe,aJ as Ze,aK as et}from"./index-247c485f.js";const tt=oe({prefixCls:{type:String}}),se=W({name:"ElSpaceItem",props:tt,setup(s,{slots:_}){const x=ne("space"),o=U(()=>`${s.prefixCls||x.b()}__item`);return()=>Ue("div",{class:o.value},ie(_,"default"))}}),le={small:8,default:12,large:16};function at(s){const _=ne("space"),x=U(()=>[_.b(),_.m(s.direction),s.class]),o=D(0),m=D(0),u=U(()=>{const r=s.wrap||s.fill?{flexWrap:"wrap",marginBottom:`-${m.value}px`}:{},v={alignItems:s.alignment};return[r,v,s.style]}),w=U(()=>{const r={paddingBottom:`${m.value}px`,marginRight:`${o.value}px`},v=s.fill?{flexGrow:1,minWidth:`${s.fillRatio}%`}:{};return[r,v]});return De(()=>{const{size:r="small",wrap:v,direction:g,fill:h}=s;if(R(r)){const[y=0,A=0]=r;o.value=y,m.value=A}else{let y;F(r)?y=r:y=le[r||"small"]||le.small,(v||h)&&g==="horizontal"?o.value=m.value=y:g==="horizontal"?(o.value=y,m.value=0):(m.value=y,o.value=0)}}),{classes:x,containerStyle:u,itemStyle:w}}const st=oe({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},class:{type:j([String,Object,Array]),default:""},style:{type:j([String,Array,Object]),default:""},alignment:{type:j(String),default:"center"},prefixCls:{type:String},spacer:{type:j([Object,String,Number,Array]),default:null,validator:s=>ce(s)||F(s)||Re(s)},wrap:Boolean,fill:Boolean,fillRatio:{type:Number,default:100},size:{type:[String,Array,Number],values:Le,validator:s=>F(s)||R(s)&&s.length===2&&s.every(F)}}),lt=W({name:"ElSpace",props:st,setup(s,{slots:_}){const{classes:x,containerStyle:o,itemStyle:m}=at(s);function u(w,r="",v=[]){const{prefixCls:g}=s;return w.forEach((h,y)=>{Z(h)?R(h.children)&&h.children.forEach((A,I)=>{Z(A)&&R(A.children)?u(A.children,`${r+I}-`,v):v.push(e(se,{style:m.value,prefixCls:g,key:`nested-${r+I}`},{default:()=>[A]},C.PROPS|C.STYLE,["style","prefixCls"]))}):ve(h)&&v.push(e(se,{style:m.value,prefixCls:g,key:`LoopKey${r+y}`},{default:()=>[h]},C.PROPS|C.STYLE,["style","prefixCls"]))}),v}return()=>{var w;const{spacer:r,direction:v}=s,g=ie(_,"default",{key:0},()=>[]);if(((w=g.children)!=null?w:[]).length===0)return null;if(R(g.children)){let h=u(g.children);if(r){const y=h.length-1;h=h.reduce((A,I,B)=>{const N=[...A,I];return B!==y&&N.push(e("span",{style:[m.value,v==="vertical"?"width: 100%":null],key:B},[ce(r)?r:p(r,C.TEXT)],C.STYLE)),N},[])}return e("div",{class:x.value,style:o.value},h,C.STYLE|C.CLASS)}return g.children}}}),ot=Be(lt);const L=s=>(Ze("data-v-6821a089"),s=s(),et(),s),nt={class:"api-keys-view"},it={class:"header-actions"},ct={class:"filters"},rt={class:"actions"},ut={class:"stats-cards"},dt={class:"stat-card"},pt={class:"stat-value"},_t=L(()=>c("div",{class:"stat-label"},"活跃API Keys",-1)),ft={class:"stat-card"},mt={class:"stat-value"},vt=L(()=>c("div",{class:"stat-label"},"今日总消费",-1)),ht={class:"stat-card"},yt={class:"stat-value"},gt=L(()=>c("div",{class:"stat-label"},"今日总请求",-1)),bt={class:"stat-card"},At={class:"stat-value"},St=L(()=>c("div",{class:"stat-label"},"平均RPM",-1)),wt={class:"card-header"},Et=L(()=>c("span",null,"API Key 列表",-1)),kt={class:"el-text",type:"info",size:"small"},xt={class:"api-key-name"},Ct={class:"el-text",strong:""},It={key:0,class:"tags"},Pt={key:0,class:"el-text",size:"small",type:"info"},Tt={key:1,class:"never-used"},Vt={class:"rpm-display"},zt={class:"rpm-text"},Kt={key:1,class:"el-text",type:"info",size:"small"},Ut={key:0,class:"api-key-details"},Dt={key:1},Rt=W({__name:"ApiKeysView",setup(s){const _=Ne(),x=$e(),o=D({groupId:"",isActive:!0,search:""}),m=D(!1),u=D(null),w=U(()=>{let n=_.apiKeys;if(o.value.groupId&&(n=n.filter(d=>d.currentGroup?.id===o.value.groupId)),o.value.isActive!==void 0&&(n=n.filter(d=>d.isActive===o.value.isActive)),o.value.search){const d=o.value.search.toLowerCase();n=n.filter(b=>b.name.toLowerCase().includes(d)||b.description?.toLowerCase().includes(d)||b.keyId.toLowerCase().includes(d))}return n=[...n].sort((d,b)=>{if(!d.lastUsedAt&&!b.lastUsedAt)return 0;if(!d.lastUsedAt)return 1;if(!b.lastUsedAt)return-1;const $=new Date(d.lastUsedAt).getTime();return new Date(b.lastUsedAt).getTime()-$}),n}),r=()=>{_.updateApiKeyFilters({groupId:o.value.groupId||void 0,isActive:o.value.isActive,search:o.value.search||void 0})},v=he(()=>{r()},500),g=async()=>{await _.fetchApiKeys()},h=()=>{console.log("Export API Keys data")},y=n=>{u.value=n,m.value=!0,x.subscribeToApiKey(n.keyId)},A=n=>{console.log("Show usage chart for",n.name)},I=n=>Math.min(n/100*100,100),B=n=>n<10?"#67c23a":n<50?"#e6a23c":"#f56c6c",N=n=>n>50?"high-cost":n>20?"medium-cost":"low-cost";return Ge(async()=>{await _.fetchGroups(),await g()}),Me(()=>{_.apiKeys.forEach(n=>{x.unsubscribe("apikey",n.keyId)})}),(n,d)=>{const b=Ve,$=ze,H=Ke,Q=ot,G=Te,M=Xe,V=Pe,P=Ie,J=xe,z=Ee,E=be,re=ge,ue=ke,de=Ae,S=Se,X=we,pe=ye,_e=me;return f(),k("div",nt,[c("div",it,[c("div",ct,[e(Q,null,{default:t(()=>[e($,{modelValue:o.value.groupId,"onUpdate:modelValue":d[0]||(d[0]=a=>o.value.groupId=a),placeholder:"选择分组",clearable:"",onChange:r},{default:t(()=>[e(b,{label:"全部分组",value:""}),(f(!0),k(ee,null,te(l(_).groups,a=>(f(),T(b,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e($,{modelValue:o.value.isActive,"onUpdate:modelValue":d[1]||(d[1]=a=>o.value.isActive=a),placeholder:"状态",onChange:r},{default:t(()=>[e(b,{label:"全部状态",value:void 0}),e(b,{label:"活跃",value:!0}),e(b,{label:"非活跃",value:!1})]),_:1},8,["modelValue"]),e(H,{modelValue:o.value.search,"onUpdate:modelValue":d[2]||(d[2]=a=>o.value.search=a),placeholder:"搜索API Key","prefix-icon":l(qe),clearable:"",onInput:l(v),style:{width:"200px"}},null,8,["modelValue","prefix-icon","onInput"])]),_:1})]),c("div",rt,[e(G,{type:"primary",icon:l(Oe),loading:l(_).loading,onClick:g},{default:t(()=>[p(" 刷新 ")]),_:1},8,["icon","loading"]),e(G,{icon:l(je),onClick:h},{default:t(()=>[p(" 导出 ")]),_:1},8,["icon"])])]),c("div",ut,[e(J,{gutter:16},{default:t(()=>[e(P,{span:6},{default:t(()=>[e(V,null,{default:t(()=>[c("div",dt,[c("div",pt,i(l(_).activeApiKeys.length),1),_t,e(M,{class:"stat-icon"},{default:t(()=>[e(l(Fe))]),_:1})])]),_:1})]),_:1}),e(P,{span:6},{default:t(()=>[e(V,null,{default:t(()=>[c("div",ft,[c("div",mt,i(l(O)(l(_).totalDailyCost)),1),vt,e(M,{class:"stat-icon"},{default:t(()=>[e(l(Ye))]),_:1})])]),_:1})]),_:1}),e(P,{span:6},{default:t(()=>[e(V,null,{default:t(()=>[c("div",ht,[c("div",yt,i(l(K)(l(_).totalTodayRequests)),1),gt,e(M,{class:"stat-icon"},{default:t(()=>[e(l(We))]),_:1})])]),_:1})]),_:1}),e(P,{span:6},{default:t(()=>[e(V,null,{default:t(()=>[c("div",bt,[c("div",At,i(l(_).averageRPM),1),St,e(M,{class:"stat-icon"},{default:t(()=>[e(l(He))]),_:1})])]),_:1})]),_:1})]),_:1})]),e(V,null,{header:t(()=>[c("div",wt,[Et,c("span",kt," 共 "+i(l(w).length)+" 个API Key ",1)])]),default:t(()=>[Qe((f(),T(de,{data:l(w),stripe:"",style:{width:"100%"},flexible:!0,onRowClick:y},{default:t(()=>[e(E,{prop:"name",label:"API Key名称","min-width":"200"},{default:t(({row:a})=>[c("div",xt,[c("span",Ct,i(a.name),1),a.tags?.length?(f(),k("div",It,[(f(!0),k(ee,null,te(a.tags.slice(0,2),q=>(f(),T(z,{key:q,size:"small",type:"info"},{default:t(()=>[p(i(q),1)]),_:2},1024))),128)),a.tags.length>2?(f(),k("span",Pt," +"+i(a.tags.length-2),1)):Y("",!0)])):Y("",!0)])]),_:1}),e(E,{prop:"lastUsedAt",label:"最后使用时间","min-width":"150",sortable:""},{default:t(({row:a})=>[a.lastUsedAt?(f(),T(re,{key:0,content:new Date(a.lastUsedAt).toLocaleString()},{default:t(()=>[c("span",null,i(l(Ce)(a.lastUsedAt)),1)]),_:2},1032,["content"])):(f(),k("span",Tt,"从未使用"))]),_:1}),e(E,{prop:"rpm",label:"RPM",width:"100",sortable:""},{default:t(({row:a})=>[c("div",Vt,[e(ue,{percentage:I(a.rpm),color:B(a.rpm),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),c("span",zt,i(a.rpm),1)])]),_:1}),e(E,{prop:"currentGroup",label:"所属分组","min-width":"120"},{default:t(({row:a})=>[a.currentGroup?(f(),T(z,{key:0,type:"primary",size:"small"},{default:t(()=>[p(i(a.currentGroup.name),1)]),_:2},1024)):(f(),k("span",Kt,"未分组"))]),_:1}),e(E,{prop:"usage.today.cost",label:"今日消费",width:"110",sortable:""},{default:t(({row:a})=>[c("span",{class:Je(N(a.usage?.today?.cost||0))},i(l(O)(a.usage?.today?.cost||0)),3)]),_:1}),e(E,{prop:"usage.today.requests",label:"今日请求",width:"110",sortable:""},{default:t(({row:a})=>[p(i(l(K)(a.usage?.today?.requests||0)),1)]),_:1}),e(E,{prop:"usage.today.totalTokens",label:"今日Token","min-width":"130",sortable:""},{default:t(({row:a})=>[p(i(l(K)(a.usage?.today?.totalTokens||0)),1)]),_:1}),e(E,{prop:"isActive",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[e(z,{type:a.isActive?"success":"danger",size:"small"},{default:t(()=>[p(i(a.isActive?"活跃":"非活跃"),1)]),_:2},1032,["type"])]),_:1}),e(E,{label:"操作","min-width":"140",fixed:"right"},{default:t(({row:a})=>[e(Q,null,{default:t(()=>[e(G,{size:"small",onClick:ae(q=>y(a),["stop"])},{default:t(()=>[p(" 详情 ")]),_:2},1032,["onClick"]),e(G,{size:"small",onClick:ae(q=>A(a),["stop"])},{default:t(()=>[p(" 趋势 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[_e,l(_).loading]])]),_:1}),e(pe,{modelValue:m.value,"onUpdate:modelValue":d[3]||(d[3]=a=>m.value=a),title:`API Key: ${u.value?.name}`,width:"800px"},{default:t(()=>[u.value?(f(),k("div",Ut,[e(J,{gutter:16},{default:t(()=>[e(P,{span:12},{default:t(()=>[e(X,{title:"基本信息",column:1,border:""},{default:t(()=>[e(S,{label:"名称"},{default:t(()=>[p(i(u.value.name),1)]),_:1}),e(S,{label:"描述"},{default:t(()=>[p(i(u.value.description||"无"),1)]),_:1}),e(S,{label:"状态"},{default:t(()=>[e(z,{type:u.value.isActive?"success":"danger"},{default:t(()=>[p(i(u.value.isActive?"活跃":"非活跃"),1)]),_:1},8,["type"])]),_:1}),e(S,{label:"所属分组"},{default:t(()=>[u.value.currentGroup?(f(),T(z,{key:0,type:"primary"},{default:t(()=>[p(i(u.value.currentGroup.name),1)]),_:1})):(f(),k("span",Dt,"未分组"))]),_:1}),e(S,{label:"最后使用"},{default:t(()=>[p(i(new Date(u.value.lastUsedAt).toLocaleString()),1)]),_:1})]),_:1})]),_:1}),e(P,{span:12},{default:t(()=>[e(X,{title:"使用统计",column:1,border:""},{default:t(()=>[e(S,{label:"RPM"},{default:t(()=>[p(i(u.value.rpm),1)]),_:1}),e(S,{label:"今日请求"},{default:t(()=>[p(i(l(K)(u.value.usage?.today?.requests||0)),1)]),_:1}),e(S,{label:"今日Token"},{default:t(()=>[p(i(l(K)(u.value.usage?.today?.totalTokens||0)),1)]),_:1}),e(S,{label:"今日费用"},{default:t(()=>[p(i(l(O)(u.value.usage?.today?.cost||0)),1)]),_:1}),e(S,{label:"费用限制"},{default:t(()=>[p(i(u.value.limits?.dailyCostLimit?l(O)(u.value.limits.dailyCostLimit):"无限制"),1)]),_:1})]),_:1})]),_:1})]),_:1})])):Y("",!0)]),_:1},8,["modelValue","title"])])}}});const Ht=fe(Rt,[["__scopeId","data-v-6821a089"]]);export{Ht as default};
