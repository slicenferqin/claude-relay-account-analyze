import{_ as oe}from"./_plugin-vue_export-helper-vHbaxTkL.js";/* empty css                   *//* empty css                   *//* empty css                        *//* empty css               *//* empty css                    */import{f as K,a as C,b as ne}from"./format-BAX8h6T0.js";/* empty css                *//* empty css                *//* empty css                  *//* empty css                  */import{q as ie,c as de,o as ce,l as ue,b as y,d as n,D as e,v as t,F as O,P as H,B as c,x as re,t as A,z as U,H as J,a5 as _e,a6 as pe,f as p}from"./vue-vendor-BkJYhFEr.js";import{_ as S,aK as me,u as s,an as fe,am as ve,aL as he,az as ye,aB as ge,a6 as be,av as Ae,aw as ke,aM as we,aN as Ce,aA as Ie,ah as o,aa as xe,ac as Ee,aD as De,aF as Ke,aO as Ve,aP as Te,aQ as Ue,ak as Se,aJ as Pe,aI as Re,n as ze,aR as Le,aS as Be,aT as Me}from"./element-plus-BlTo_VXI.js";import{u as Ge,a as Ne}from"./index-CL1UbGLD.js";import{d as qe}from"./utils-2ne8F3OK.js";const I=x=>(_e("data-v-6821a089"),x=x(),pe(),x),Fe={class:"api-keys-view"},$e={class:"header-actions"},Oe={class:"filters"},He={class:"actions"},Je=c(" 刷新 "),Qe=c(" 导出 "),je={class:"stats-cards"},We={class:"stat-card"},Xe={class:"stat-value"},Ye=I(()=>n("div",{class:"stat-label"},"活跃API Keys",-1)),Ze={class:"stat-card"},et={class:"stat-value"},tt=I(()=>n("div",{class:"stat-label"},"今日总消费",-1)),at={class:"stat-card"},st={class:"stat-value"},lt=I(()=>n("div",{class:"stat-label"},"今日总请求",-1)),ot={class:"stat-card"},nt={class:"stat-value"},it=I(()=>n("div",{class:"stat-label"},"平均RPM",-1)),dt={class:"card-header"},ct=I(()=>n("span",null,"API Key 列表",-1)),ut={class:"el-text",type:"info",size:"small"},rt={class:"api-key-name"},_t={class:"el-text",strong:""},pt={key:0,class:"tags"},mt={key:0,class:"el-text",size:"small",type:"info"},ft={key:1,class:"never-used"},vt={class:"rpm-display"},ht={class:"rpm-text"},yt={key:1,class:"el-text",type:"info",size:"small"},gt=c(" 详情 "),bt=c(" 趋势 "),At={key:0,class:"api-key-details"},kt={key:1},wt=ie({__name:"ApiKeysView",setup(x){const m=Ge(),P=Ne(),_=S({groupId:"",isActive:!0,search:""}),V=S(!1),u=S(null),R=de(()=>{let l=m.apiKeys;if(_.value.groupId&&(l=l.filter(d=>{var r;return((r=d.currentGroup)==null?void 0:r.id)===_.value.groupId})),_.value.isActive!==void 0&&(l=l.filter(d=>d.isActive===_.value.isActive)),_.value.search){const d=_.value.search.toLowerCase();l=l.filter(r=>{var g;return r.name.toLowerCase().includes(d)||((g=r.description)==null?void 0:g.toLowerCase().includes(d))||r.keyId.toLowerCase().includes(d)})}return l=[...l].sort((d,r)=>{if(!d.lastUsedAt&&!r.lastUsedAt)return 0;if(!d.lastUsedAt)return 1;if(!r.lastUsedAt)return-1;const g=new Date(d.lastUsedAt).getTime();return new Date(r.lastUsedAt).getTime()-g}),l}),T=()=>{m.updateApiKeyFilters({groupId:_.value.groupId||void 0,isActive:_.value.isActive,search:_.value.search||void 0})},Q=qe(()=>{T()},500),z=async()=>{await m.fetchApiKeys()},j=()=>{console.log("Export API Keys data")},L=l=>{u.value=l,V.value=!0,P.subscribeToApiKey(l.keyId)},W=l=>{console.log("Show usage chart for",l.name)},X=l=>Math.min(l/100*100,100),Y=l=>l<10?"#67c23a":l<50?"#e6a23c":"#f56c6c",Z=l=>l>50?"high-cost":l>20?"medium-cost":"low-cost";return ce(async()=>{await m.fetchGroups(),await z()}),ue(()=>{m.apiKeys.forEach(l=>{P.unsubscribe("apikey",l.keyId)})}),(l,d)=>{var q;const r=ke,g=Ae,B=we,M=me,E=ve,D=xe,k=ge,b=Ie,G=ye,w=Re,h=Ue,ee=Se,te=Pe,ae=Me,v=Be,N=Le,se=be,le=Te;return p(),y("div",Fe,[n("div",$e,[n("div",Oe,[e(M,null,{default:t(()=>[e(g,{modelValue:_.value.groupId,"onUpdate:modelValue":d[0]||(d[0]=a=>_.value.groupId=a),placeholder:"选择分组",clearable:"",onChange:T},{default:t(()=>[e(r,{label:"全部分组",value:""}),(p(!0),y(O,null,H(s(m).groups,a=>(p(),A(r,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(g,{modelValue:_.value.isActive,"onUpdate:modelValue":d[1]||(d[1]=a=>_.value.isActive=a),placeholder:"状态",onChange:T},{default:t(()=>[e(r,{label:"全部状态",value:void 0}),e(r,{label:"活跃",value:!0}),e(r,{label:"非活跃",value:!1})]),_:1},8,["modelValue"]),e(B,{modelValue:_.value.search,"onUpdate:modelValue":d[2]||(d[2]=a=>_.value.search=a),placeholder:"搜索API Key","prefix-icon":s(Ce),clearable:"",onInput:s(Q),style:{width:"200px"}},null,8,["modelValue","prefix-icon","onInput"])]),_:1})]),n("div",He,[e(E,{type:"primary",icon:s(fe),loading:s(m).loading,onClick:z},{default:t(()=>[Je]),_:1},8,["icon","loading"]),e(E,{icon:s(he),onClick:j},{default:t(()=>[Qe]),_:1},8,["icon"])])]),n("div",je,[e(G,{gutter:16},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[n("div",We,[n("div",Xe,o(s(m).activeApiKeys.length),1),Ye,e(D,{class:"stat-icon"},{default:t(()=>[e(s(Ee))]),_:1})])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[n("div",Ze,[n("div",et,o(s(K)(s(m).totalDailyCost)),1),tt,e(D,{class:"stat-icon"},{default:t(()=>[e(s(De))]),_:1})])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[n("div",at,[n("div",st,o(s(C)(s(m).totalTodayRequests)),1),lt,e(D,{class:"stat-icon"},{default:t(()=>[e(s(Ke))]),_:1})])]),_:1})]),_:1}),e(b,{span:6},{default:t(()=>[e(k,null,{default:t(()=>[n("div",ot,[n("div",nt,o(s(m).averageRPM),1),it,e(D,{class:"stat-icon"},{default:t(()=>[e(s(Ve))]),_:1})])]),_:1})]),_:1})]),_:1})]),e(k,null,{header:t(()=>[n("div",dt,[ct,n("span",ut," 共 "+o(s(R).length)+" 个API Key ",1)])]),default:t(()=>[re((p(),A(ae,{data:s(R),stripe:"",style:{width:"100%"},flexible:!0,onRowClick:L},{default:t(()=>[e(h,{prop:"name",label:"API Key名称","min-width":"200"},{default:t(({row:a})=>{var i;return[n("div",rt,[n("span",_t,o(a.name),1),(i=a.tags)!=null&&i.length?(p(),y("div",pt,[(p(!0),y(O,null,H(a.tags.slice(0,2),f=>(p(),A(w,{key:f,size:"small",type:"info"},{default:t(()=>[c(o(f),1)]),_:2},1024))),128)),a.tags.length>2?(p(),y("span",mt," +"+o(a.tags.length-2),1)):U("",!0)])):U("",!0)])]}),_:1}),e(h,{prop:"lastUsedAt",label:"最后使用时间","min-width":"150",sortable:""},{default:t(({row:a})=>[a.lastUsedAt?(p(),A(ee,{key:0,content:new Date(a.lastUsedAt).toLocaleString()},{default:t(()=>[n("span",null,o(s(ne)(a.lastUsedAt)),1)]),_:2},1032,["content"])):(p(),y("span",ft,"从未使用"))]),_:1}),e(h,{prop:"rpm",label:"RPM",width:"100",sortable:""},{default:t(({row:a})=>[n("div",vt,[e(te,{percentage:X(a.rpm),color:Y(a.rpm),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),n("span",ht,o(a.rpm),1)])]),_:1}),e(h,{prop:"currentGroup",label:"所属分组","min-width":"120"},{default:t(({row:a})=>[a.currentGroup?(p(),A(w,{key:0,type:"primary",size:"small"},{default:t(()=>[c(o(a.currentGroup.name),1)]),_:2},1024)):(p(),y("span",yt,"未分组"))]),_:1}),e(h,{prop:"usage.today.cost",label:"今日消费",width:"110",sortable:""},{default:t(({row:a})=>{var i,f,F,$;return[n("span",{class:ze(Z(((f=(i=a.usage)==null?void 0:i.today)==null?void 0:f.cost)||0))},o(s(K)((($=(F=a.usage)==null?void 0:F.today)==null?void 0:$.cost)||0)),3)]}),_:1}),e(h,{prop:"usage.today.requests",label:"今日请求",width:"110",sortable:""},{default:t(({row:a})=>{var i,f;return[c(o(s(C)(((f=(i=a.usage)==null?void 0:i.today)==null?void 0:f.requests)||0)),1)]}),_:1}),e(h,{prop:"usage.today.totalTokens",label:"今日Token","min-width":"130",sortable:""},{default:t(({row:a})=>{var i,f;return[c(o(s(C)(((f=(i=a.usage)==null?void 0:i.today)==null?void 0:f.totalTokens)||0)),1)]}),_:1}),e(h,{prop:"isActive",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[e(w,{type:a.isActive?"success":"danger",size:"small"},{default:t(()=>[c(o(a.isActive?"活跃":"非活跃"),1)]),_:2},1032,["type"])]),_:1}),e(h,{label:"操作","min-width":"140",fixed:"right"},{default:t(({row:a})=>[e(M,null,{default:t(()=>[e(E,{size:"small",onClick:J(i=>L(a),["stop"])},{default:t(()=>[gt]),_:2},1032,["onClick"]),e(E,{size:"small",onClick:J(i=>W(a),["stop"])},{default:t(()=>[bt]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[le,s(m).loading]])]),_:1}),e(se,{modelValue:V.value,"onUpdate:modelValue":d[3]||(d[3]=a=>V.value=a),title:`API Key: ${(q=u.value)==null?void 0:q.name}`,width:"800px"},{default:t(()=>[u.value?(p(),y("div",At,[e(G,{gutter:16},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(N,{title:"基本信息",column:1,border:""},{default:t(()=>[e(v,{label:"名称"},{default:t(()=>[c(o(u.value.name),1)]),_:1}),e(v,{label:"描述"},{default:t(()=>[c(o(u.value.description||"无"),1)]),_:1}),e(v,{label:"状态"},{default:t(()=>[e(w,{type:u.value.isActive?"success":"danger"},{default:t(()=>[c(o(u.value.isActive?"活跃":"非活跃"),1)]),_:1},8,["type"])]),_:1}),e(v,{label:"所属分组"},{default:t(()=>[u.value.currentGroup?(p(),A(w,{key:0,type:"primary"},{default:t(()=>[c(o(u.value.currentGroup.name),1)]),_:1})):(p(),y("span",kt,"未分组"))]),_:1}),e(v,{label:"最后使用"},{default:t(()=>[c(o(new Date(u.value.lastUsedAt).toLocaleString()),1)]),_:1})]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(N,{title:"使用统计",column:1,border:""},{default:t(()=>[e(v,{label:"RPM"},{default:t(()=>[c(o(u.value.rpm),1)]),_:1}),e(v,{label:"今日请求"},{default:t(()=>{var a,i;return[c(o(s(C)(((i=(a=u.value.usage)==null?void 0:a.today)==null?void 0:i.requests)||0)),1)]}),_:1}),e(v,{label:"今日Token"},{default:t(()=>{var a,i;return[c(o(s(C)(((i=(a=u.value.usage)==null?void 0:a.today)==null?void 0:i.totalTokens)||0)),1)]}),_:1}),e(v,{label:"今日费用"},{default:t(()=>{var a,i;return[c(o(s(K)(((i=(a=u.value.usage)==null?void 0:a.today)==null?void 0:i.cost)||0)),1)]}),_:1}),e(v,{label:"费用限制"},{default:t(()=>{var a;return[c(o((a=u.value.limits)!=null&&a.dailyCostLimit?s(K)(u.value.limits.dailyCostLimit):"无限制"),1)]}),_:1})]),_:1})]),_:1})]),_:1})])):U("",!0)]),_:1},8,["modelValue","title"])])}}}),Mt=oe(wt,[["__scopeId","data-v-6821a089"]]);export{Mt as default};
