import{q as ne,c as ie,o as de,l as ce,d as g,e as n,D as e,v as t,K as u,V as ue,b as m,F as H,N as J,x as re,t as k,A as T,B as c,H as O,a5 as _e,a6 as pe}from"./vue-vendor-b6cd13bd.js";import{$ as R,u as s,ak as me,ae as fe,al as ve,ad as o,a9 as he,ah as ye,aj as ge,am as be,n as Ae}from"./element-plus-7892819a.js";import{u as ke,a as we}from"./index-ceb58776.js";import{f as D,a as I,b as Ce}from"./format-96392f60.js";import{d as Ie}from"./utils-e3271d43.js";import{_ as xe}from"./_plugin-vue_export-helper-c27b6911.js";const x=V=>(_e("data-v-6821a089"),V=V(),pe(),V),Ve={class:"api-keys-view"},Ke={class:"header-actions"},Ue={class:"filters"},De={class:"actions"},Se=c(" 刷新 "),Pe=c(" 导出 "),Te={class:"stats-cards"},Re={class:"stat-card"},ze={class:"stat-value"},Le=x(()=>n("div",{class:"stat-label"},"活跃API Keys",-1)),Be={class:"stat-card"},Ge={class:"stat-value"},Me=x(()=>n("div",{class:"stat-label"},"今日总消费",-1)),Ne={class:"stat-card"},qe={class:"stat-value"},Fe=x(()=>n("div",{class:"stat-label"},"今日总请求",-1)),$e={class:"stat-card"},Ee={class:"stat-value"},je=x(()=>n("div",{class:"stat-label"},"平均RPM",-1)),He={class:"card-header"},Je=x(()=>n("span",null,"API Key 列表",-1)),Oe={class:"el-text",type:"info",size:"small"},Qe={class:"api-key-name"},We={class:"el-text",strong:""},Xe={key:0,class:"tags"},Ye={key:0,class:"el-text",size:"small",type:"info"},Ze={key:1,class:"never-used"},et={class:"rpm-display"},tt={class:"rpm-text"},at={key:1,class:"el-text",type:"info",size:"small"},st=c(" 详情 "),lt=c(" 趋势 "),ot={key:0,class:"api-key-details"},nt={key:1},it=ne({setup(V){const f=ke(),z=we(),p=R({groupId:"",isActive:!0,search:""}),S=R(!1),r=R(null),L=ie(()=>{let l=f.apiKeys;if(p.value.groupId&&(l=l.filter(d=>{var _;return((_=d.currentGroup)==null?void 0:_.id)===p.value.groupId})),p.value.isActive!==void 0&&(l=l.filter(d=>d.isActive===p.value.isActive)),p.value.search){const d=p.value.search.toLowerCase();l=l.filter(_=>{var b;return _.name.toLowerCase().includes(d)||((b=_.description)==null?void 0:b.toLowerCase().includes(d))||_.keyId.toLowerCase().includes(d)})}return l=[...l].sort((d,_)=>{if(!d.lastUsedAt&&!_.lastUsedAt)return 0;if(!d.lastUsedAt)return 1;if(!_.lastUsedAt)return-1;const b=new Date(d.lastUsedAt).getTime();return new Date(_.lastUsedAt).getTime()-b}),l}),P=()=>{f.updateApiKeyFilters({groupId:p.value.groupId||void 0,isActive:p.value.isActive,search:p.value.search||void 0})},Q=Ie(()=>{P()},500),B=async()=>{await f.fetchApiKeys()},W=()=>{console.log("Export API Keys data")},G=l=>{r.value=l,S.value=!0,z.subscribeToApiKey(l.keyId)},X=l=>{console.log("Show usage chart for",l.name)},Y=l=>Math.min(l/100*100,100),Z=l=>l<10?"#67c23a":l<50?"#e6a23c":"#f56c6c",ee=l=>l>50?"high-cost":l>20?"medium-cost":"low-cost";return de(async()=>{await f.fetchGroups(),await B()}),ce(()=>{f.apiKeys.forEach(l=>{z.unsubscribe("apikey",l.keyId)})}),(l,d)=>{var $;const _=u("el-option"),b=u("el-select"),M=u("el-input"),N=u("el-space"),K=u("el-button"),U=u("el-icon"),w=u("el-card"),A=u("el-col"),q=u("el-row"),C=u("el-tag"),y=u("el-table-column"),te=u("el-tooltip"),ae=u("el-progress"),se=u("el-table"),h=u("el-descriptions-item"),F=u("el-descriptions"),le=u("el-dialog"),oe=ue("loading");return m(),g("div",Ve,[n("div",Ke,[n("div",Ue,[e(N,null,{default:t(()=>[e(b,{modelValue:p.value.groupId,"onUpdate:modelValue":d[0]||(d[0]=a=>p.value.groupId=a),placeholder:"选择分组",clearable:"",onChange:P},{default:t(()=>[e(_,{label:"全部分组",value:""}),(m(!0),g(H,null,J(s(f).groups,a=>(m(),k(_,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(b,{modelValue:p.value.isActive,"onUpdate:modelValue":d[1]||(d[1]=a=>p.value.isActive=a),placeholder:"状态",onChange:P},{default:t(()=>[e(_,{label:"全部状态",value:void 0}),e(_,{label:"活跃",value:!0}),e(_,{label:"非活跃",value:!1})]),_:1},8,["modelValue"]),e(M,{modelValue:p.value.search,"onUpdate:modelValue":d[2]||(d[2]=a=>p.value.search=a),placeholder:"搜索API Key","prefix-icon":s(me),clearable:"",onInput:s(Q),style:{width:"200px"}},null,8,["modelValue","prefix-icon","onInput"])]),_:1})]),n("div",De,[e(K,{type:"primary",icon:s(fe),loading:s(f).loading,onClick:B},{default:t(()=>[Se]),_:1},8,["icon","loading"]),e(K,{icon:s(ve),onClick:W},{default:t(()=>[Pe]),_:1},8,["icon"])])]),n("div",Te,[e(q,{gutter:16},{default:t(()=>[e(A,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[n("div",Re,[n("div",ze,o(s(f).activeApiKeys.length),1),Le,e(U,{class:"stat-icon"},{default:t(()=>[e(s(he))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[n("div",Be,[n("div",Ge,o(s(D)(s(f).totalDailyCost)),1),Me,e(U,{class:"stat-icon"},{default:t(()=>[e(s(ye))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[n("div",Ne,[n("div",qe,o(s(I)(s(f).totalTodayRequests)),1),Fe,e(U,{class:"stat-icon"},{default:t(()=>[e(s(ge))]),_:1})])]),_:1})]),_:1}),e(A,{span:6},{default:t(()=>[e(w,null,{default:t(()=>[n("div",$e,[n("div",Ee,o(s(f).averageRPM),1),je,e(U,{class:"stat-icon"},{default:t(()=>[e(s(be))]),_:1})])]),_:1})]),_:1})]),_:1})]),e(w,null,{header:t(()=>[n("div",He,[Je,n("span",Oe," 共 "+o(s(L).length)+" 个API Key ",1)])]),default:t(()=>[re((m(),k(se,{data:s(L),stripe:"",style:{width:"100%"},flexible:!0,onRowClick:G},{default:t(()=>[e(y,{prop:"name",label:"API Key名称","min-width":"200"},{default:t(({row:a})=>{var i;return[n("div",Qe,[n("span",We,o(a.name),1),(i=a.tags)!=null&&i.length?(m(),g("div",Xe,[(m(!0),g(H,null,J(a.tags.slice(0,2),v=>(m(),k(C,{key:v,size:"small",type:"info"},{default:t(()=>[c(o(v),1)]),_:2},1024))),128)),a.tags.length>2?(m(),g("span",Ye," +"+o(a.tags.length-2),1)):T("",!0)])):T("",!0)])]}),_:1}),e(y,{prop:"lastUsedAt",label:"最后使用时间","min-width":"150",sortable:""},{default:t(({row:a})=>[a.lastUsedAt?(m(),k(te,{key:0,content:new Date(a.lastUsedAt).toLocaleString()},{default:t(()=>[n("span",null,o(s(Ce)(a.lastUsedAt)),1)]),_:2},1032,["content"])):(m(),g("span",Ze,"从未使用"))]),_:1}),e(y,{prop:"rpm",label:"RPM",width:"100",sortable:""},{default:t(({row:a})=>[n("div",et,[e(ae,{percentage:Y(a.rpm),color:Z(a.rpm),"stroke-width":6,"show-text":!1},null,8,["percentage","color"]),n("span",tt,o(a.rpm),1)])]),_:1}),e(y,{prop:"currentGroup",label:"所属分组","min-width":"120"},{default:t(({row:a})=>[a.currentGroup?(m(),k(C,{key:0,type:"primary",size:"small"},{default:t(()=>[c(o(a.currentGroup.name),1)]),_:2},1024)):(m(),g("span",at,"未分组"))]),_:1}),e(y,{prop:"usage.today.cost",label:"今日消费",width:"110",sortable:""},{default:t(({row:a})=>{var i,v,E,j;return[n("span",{class:Ae(ee(((v=(i=a.usage)==null?void 0:i.today)==null?void 0:v.cost)||0))},o(s(D)(((j=(E=a.usage)==null?void 0:E.today)==null?void 0:j.cost)||0)),3)]}),_:1}),e(y,{prop:"usage.today.requests",label:"今日请求",width:"110",sortable:""},{default:t(({row:a})=>{var i,v;return[c(o(s(I)(((v=(i=a.usage)==null?void 0:i.today)==null?void 0:v.requests)||0)),1)]}),_:1}),e(y,{prop:"usage.today.totalTokens",label:"今日Token","min-width":"130",sortable:""},{default:t(({row:a})=>{var i,v;return[c(o(s(I)(((v=(i=a.usage)==null?void 0:i.today)==null?void 0:v.totalTokens)||0)),1)]}),_:1}),e(y,{prop:"isActive",label:"状态",width:"90",align:"center"},{default:t(({row:a})=>[e(C,{type:a.isActive?"success":"danger",size:"small"},{default:t(()=>[c(o(a.isActive?"活跃":"非活跃"),1)]),_:2},1032,["type"])]),_:1}),e(y,{label:"操作","min-width":"140",fixed:"right"},{default:t(({row:a})=>[e(N,null,{default:t(()=>[e(K,{size:"small",onClick:O(i=>G(a),["stop"])},{default:t(()=>[st]),_:2},1032,["onClick"]),e(K,{size:"small",onClick:O(i=>X(a),["stop"])},{default:t(()=>[lt]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[oe,s(f).loading]])]),_:1}),e(le,{modelValue:S.value,"onUpdate:modelValue":d[3]||(d[3]=a=>S.value=a),title:`API Key: ${($=r.value)==null?void 0:$.name}`,width:"800px"},{default:t(()=>[r.value?(m(),g("div",ot,[e(q,{gutter:16},{default:t(()=>[e(A,{span:12},{default:t(()=>[e(F,{title:"基本信息",column:1,border:""},{default:t(()=>[e(h,{label:"名称"},{default:t(()=>[c(o(r.value.name),1)]),_:1}),e(h,{label:"描述"},{default:t(()=>[c(o(r.value.description||"无"),1)]),_:1}),e(h,{label:"状态"},{default:t(()=>[e(C,{type:r.value.isActive?"success":"danger"},{default:t(()=>[c(o(r.value.isActive?"活跃":"非活跃"),1)]),_:1},8,["type"])]),_:1}),e(h,{label:"所属分组"},{default:t(()=>[r.value.currentGroup?(m(),k(C,{key:0,type:"primary"},{default:t(()=>[c(o(r.value.currentGroup.name),1)]),_:1})):(m(),g("span",nt,"未分组"))]),_:1}),e(h,{label:"最后使用"},{default:t(()=>[c(o(new Date(r.value.lastUsedAt).toLocaleString()),1)]),_:1})]),_:1})]),_:1}),e(A,{span:12},{default:t(()=>[e(F,{title:"使用统计",column:1,border:""},{default:t(()=>[e(h,{label:"RPM"},{default:t(()=>[c(o(r.value.rpm),1)]),_:1}),e(h,{label:"今日请求"},{default:t(()=>{var a,i;return[c(o(s(I)(((i=(a=r.value.usage)==null?void 0:a.today)==null?void 0:i.requests)||0)),1)]}),_:1}),e(h,{label:"今日Token"},{default:t(()=>{var a,i;return[c(o(s(I)(((i=(a=r.value.usage)==null?void 0:a.today)==null?void 0:i.totalTokens)||0)),1)]}),_:1}),e(h,{label:"今日费用"},{default:t(()=>{var a,i;return[c(o(s(D)(((i=(a=r.value.usage)==null?void 0:a.today)==null?void 0:i.cost)||0)),1)]}),_:1}),e(h,{label:"费用限制"},{default:t(()=>{var a;return[c(o((a=r.value.limits)!=null&&a.dailyCostLimit?s(D)(r.value.limits.dailyCostLimit):"无限制"),1)]}),_:1})]),_:1})]),_:1})]),_:1})])):T("",!0)]),_:1},8,["modelValue","title"])])}}});const mt=xe(it,[["__scopeId","data-v-6821a089"]]);export{mt as default};
